(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2c57e8d8"],{"0218":function(t,e,s){"use strict";s.d(e,"b",(function(){return u})),s.d(e,"a",(function(){return p}));var a,i,n=s("bd86"),o=s("0692"),c="notified",r="approved",l="rejected",d="closed",u=(a={},Object(n["a"])(a,c,{type:"success",title:o["a"].t("tickets.Pending")}),Object(n["a"])(a,r,{type:"primary",title:o["a"].t("tickets.Approved")}),Object(n["a"])(a,l,{type:"danger",title:o["a"].t("tickets.Rejected")}),Object(n["a"])(a,d,{type:"info",title:o["a"].t("tickets.Closed")}),a),p=(i={},Object(n["a"])(i,c,{type:"success",title:o["a"].t("tickets.Pending")}),Object(n["a"])(i,r,{type:"primary",title:o["a"].t("tickets.Approved")}),Object(n["a"])(i,l,{type:"danger",title:o["a"].t("tickets.Rejected")}),Object(n["a"])(i,d,{type:"warning",title:o["a"].t("tickets.StateClosed")}),i)},"0797":function(t,e,s){},"15db":function(t,e,s){"use strict";var a=s("0797"),i=s.n(a);i.a},"2e08":function(t,e,s){var a=s("9def"),i=s("9744"),n=s("be13");t.exports=function(t,e,s,o){var c=String(n(t)),r=c.length,l=void 0===s?" ":String(s),d=a(e);if(d<=r||""==l)return c;var u=d-r,p=i.call(l,Math.ceil(u/l.length));return p.length>u&&(p=p.slice(0,u)),o?p+c:c+p}},"8af7":function(t,e,s){"use strict";var a=s("9722"),i=s.n(a);i.a},9722:function(t,e,s){},9744:function(t,e,s){"use strict";var a=s("4588"),i=s("be13");t.exports=function(t){var e=String(i(this)),s="",n=a(t);if(n<0||n==1/0)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(s+=e);return s}},"9cdc":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-row",[s("el-col",{attrs:{span:17}},[s("Details",{attrs:{"detail-card-items":t.detailCardItems,title:t.$t("common.BasicInfo")}}),t._v(" "),t.specialCardItems.length>0?s("Details",{attrs:{"detail-card-items":t.specialCardItems,title:t.$t("common.ApplyInfo")}}):t._e(),t._v(" "),"approved"===t.object.state&&t.assignedCardItems.length>0?s("Details",{attrs:{"detail-card-items":t.assignedCardItems,title:t.$t("tickets.AssignedInfo")}}):t._e(),t._v(" "),t._t("default",null,{id:"MoreDetails"}),t._v(" "),s("Comments",t._b({attrs:{object:t.object}},"Comments",t.$attrs,!1))],2),t._v(" "),s("el-col",{attrs:{span:6,offset:1}},[s("Steps",{attrs:{object:t.object}})],1)],1)},i=[],n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("IBox",{staticClass:"box"},[s("div",{staticClass:"clearfix ibox-title",attrs:{slot:"header"},slot:"header"},[s("i",{staticClass:"fa fa-info-circle"}),t._v(" "+t._s(t.title)+"\n  ")]),t._v(" "),s("div",{staticClass:"content"},[s("el-row",{attrs:{gutter:10}},t._l(t.detailCardItems,(function(e){return s("el-col",{key:"card-"+e.key,attrs:{span:12}},[s("el-row",{staticClass:"item"},[s("el-col",{attrs:{span:6}},[s("div",{staticClass:"item-label",style:{"text-align":"align"}},[s("label",[t._v(t._s(e.key)+": ")])])]),t._v(" "),s("el-col",{attrs:{span:18}},[s("div",{staticClass:"item-text"},[s("ItemValue",t._b({},"ItemValue",e,!1))],1)])],1)],1)})),1),t._v(" "),t.specialCardItems.length>0?s("el-divider"):t._e(),t._v(" "),s("el-row",{attrs:{gutter:10}},t._l(t.specialCardItems,(function(e){return s("el-col",{key:"card-"+e.key,attrs:{span:12}},[s("el-row",{staticClass:"item"},[s("el-col",{attrs:{span:6}},[s("div",{staticClass:"item-label",style:{"text-align":"align"}},[s("label",[t._v(t._s(e.key)+": ")])])]),t._v(" "),s("el-col",{attrs:{span:18}},[s("div",{staticClass:"item-text"},[s("ItemValue",t._b({},"ItemValue",e,!1))],1)])],1)],1)})),1)],1)])},o=[],c=s("a735"),r=s("e67a"),l={name:"Details",components:{ItemValue:c["a"],IBox:r["a"]},props:{specialCardItems:{type:Array,default:function(){return[]}},detailCardItems:{type:Array,default:function(){return[]}},title:{type:String,default:""}},data:function(){return{}}},d=l,u=(s("8af7"),s("2877")),p=Object(u["a"])(d,n,o,!1,null,"52bb7e9c",null),f=p.exports,m=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("IBox",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"box"},[s("div",{staticClass:"clearfix ibox-title",attrs:{slot:"header"},slot:"header"},[s("i",{staticClass:"fa fa-comments"}),t._v(" "+t._s(t.$t("common.Message"))+"\n    ")]),t._v(" "),t.comments?t._l(t.comments,(function(e){return s("div",{key:e.id,staticClass:"feed-activity-list"},[s("div",{staticClass:"feed-element"},[s("a",{staticClass:"pull-left",attrs:{href:"#"}},[s("el-avatar",{staticClass:"header-avatar",attrs:{src:t.imageUrl}})],1),t._v(" "),s("div",{staticClass:"media-body "},[s("strong",[t._v(t._s(e.user_display))]),t._v(" "),s("small",{staticClass:"text-muted"},[t._v(t._s(t.formatTime(e.date_created)))]),t._v(" "),s("br"),t._v(" "),s("small",{staticClass:"text-muted"},[t._v(t._s(t.toSafeLocalDateStr(e.date_created)))]),t._v(" "),s("pre",{staticStyle:{"padding-top":"10px",overflow:"auto"}},[t._v(t._s(e.body)+"\n            ")])])])])})):t._e(),t._v(" "),t._t("default"),t._v(" "),s("el-form",{ref:"comments",staticStyle:{"padding-top":"20px"},attrs:{model:t.form,"label-width":"45px"}},[s("el-form-item",{attrs:{label:t.$t("tickets.reply")}},[s("el-input",{attrs:{autosize:{minRows:4},type:"textarea"},model:{value:t.form.comments,callback:function(e){t.$set(t.form,"comments",e)},expression:"form.comments"}})],1),t._v(" "),s("el-form-item",{staticStyle:{float:"right"}},[t.hasActionPerm?[s("el-button",{attrs:{disabled:"closed"===t.object.status,type:"primary",size:"small"},on:{click:t.handleApprove}},[s("i",{staticClass:"fa fa-check"}),t._v(" "+t._s(t.$t("tickets.Accept"))+"\n          ")]),t._v(" "),s("el-button",{attrs:{disabled:"closed"===t.object.status,type:"warning",size:"small"},on:{click:t.handleReject}},[s("i",{staticClass:"fa fa-ban"}),t._v(" "+t._s(t.$t("tickets.Reject"))+"\n          ")])]:t._e(),t._v(" "),t.isSelfTicket?s("el-button",{attrs:{disabled:"closed"===t.object.status,type:"danger",size:"small"},on:{click:t.handleClose}},[s("i",{staticClass:"fa fa-times"}),t._v(" "+t._s(t.$t("tickets.Close"))+"\n        ")]):t._e(),t._v(" "),s("el-button",{attrs:{disabled:"closed"===t.object.status,type:"info",size:"small"},on:{click:t.handleComment}},[s("i",{staticClass:"fa fa-pencil"}),t._v(" "+t._s(t.$t("tickets.reply"))+"\n        ")])],2)],1)],2)},v=[],h=(s("57e7"),s("ed08")),_=s("cf45"),b={name:"Comments",components:{IBox:r["a"]},props:{object:{type:Object,default:function(){return{}}},approve:{type:Function,default:null},reject:{type:Function,default:null},close:{type:Function,default:null}},data:function(){return{comments:"",imageUrl:s("059c"),form:{comments:""},loading:!1}},computed:{hasActionPerm:function(){return-1!==this.object.process_map[this.object.approval_step-1].assignees.indexOf(this.$store.state.users.profile.id)},isSelfTicket:function(){return this.object.applicant===this.$store.state.users.profile.id}},mounted:function(){this.getComment()},methods:{formatTime:function(t){return Object(h["a"])(Object(h["b"])(t))},toSafeLocalDateStr:function(t){return Object(_["p"])(t)},getComment:function(){var t=this;this.loading=!0;var e="/api/v1/tickets/comments/?ticket_id=".concat(this.object.id);this.$axios.get(e).then((function(e){t.comments=e})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1,t.form.comments=""}))},defaultApprove:function(){var t=this;this.createComment((function(){}));var e="/api/v1/tickets/tickets/".concat(this.object.id,"/approve/");this.$axios.put(e).then((function(e){return t.reloadPage()})).catch((function(e){return t.$message.error(e)}))},defaultReject:function(){var t=this;this.createComment((function(){}));var e="/api/v1/tickets/tickets/".concat(this.object.id,"/reject/");this.$axios.put(e).then((function(e){return t.reloadPage()})).catch((function(e){return t.$message.error(e)}))},defaultClose:function(){var t=this,e="/api/v1/tickets/tickets/".concat(this.object.id,"/close/");this.$axios.put(e).then((function(e){return t.reloadPage()})).catch((function(e){return t.$message.error(e)}))},createComment:function(t){var e=this,s=this.form.comments,a=this.object.id,i="/api/v1/tickets/comments/?ticket_id=".concat(this.object.id);if(s){var n={body:s,ticket:a};this.$axios.post(i,n).then((function(s){t?t():e.reloadPage()}))}},handleApprove:function(){var t=this.approve||this.defaultApprove;t()},handleReject:function(){var t=this.reject||this.defaultReject;t()},handleClose:function(){var t=this.close||this.defaultClose;t()},handleComment:function(){this.createComment(this.getComment)},reloadPage:function(){window.location.reload()}}},g=b,y=(s("15db"),Object(u["a"])(g,m,v,!1,null,"6769e58e",null)),C=y.exports,j=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("IBox",[s("div",{staticStyle:{height:"540px"}},[s("el-steps",{attrs:{direction:"vertical",active:t.ticketSteps}},[s("el-step",{attrs:{title:this.$t("tickets.OpenTicket")+"："+t.object.type_display,description:this.$t("tickets.Applicant")+"："+t.object.user_display}},[s("div",{attrs:{slot:"description"},slot:"description"},[s("div",[t._v(t._s(this.$t("tickets.Applicant")+"："+t.object.applicant_display))]),t._v(" "),s("div",[t._v(t._s(this.$t("common.dateCreated")+":  "+t.toSafeLocalDateStr(t.object.date_created)))])])]),t._v(" "),t._l(t.process,(function(e,a){return s("el-step",{key:a,attrs:{title:""+t.thisCopy.$t("tickets.HandleTicket")}},[s("div",{attrs:{slot:"description"},slot:"description"},[s("el-tag",{attrs:{size:"medium",type:""+t.thisCopy.statusMap[e.state].type}},[t._v(" "+t._s(""+t.thisCopy.statusMap[e.state].title)+" ")])],1),t._v(" "),s("div",{attrs:{slot:"description"},slot:"description"},[s("el-button",{staticStyle:{color:"blue"},attrs:{type:"text"},on:{click:function(s){return t.lookOver(e.assignees_display)}}},[t._v("点击查看 受理人")])],1),t._v(" "),"closed"===e.state?s("div",{attrs:{slot:"description"},slot:"description"},[s("div",[t._v(t._s(t.thisCopy.$t("tickets.Assignee")+"："+t.object.applicant_display))]),t._v(" "),s("div",[t._v(t._s(t.thisCopy.$t("common.dateFinished")+":  "+t.toSafeLocalDateStr(e.approval_date)))])]):t._e(),t._v(" "),"notified"!==e.state&&"closed"!==e.state?s("div",{attrs:{slot:"description"},slot:"description"},[s("div",[t._v(t._s(t.thisCopy.$t("tickets.Assignee")+"："+e.processor_display))]),t._v(" "),s("div",[t._v(t._s(t.thisCopy.$t("common.dateFinished")+":  "+t.toSafeLocalDateStr(e.approval_date)))])]):t._e()])})),t._v(" "),s("el-step",{attrs:{title:""+this.$t("tickets.FinishedTicket")}},[t.thisCopy.isFinish?s("div",{attrs:{slot:"description"},slot:"description"},[s("div",[t._v(t._s(this.$t("common.dateFinished")+":  "+t.toSafeLocalDateStr(t.object.date_updated)))])]):t._e()])],2)],1)])},k=[],S=s("c564"),$=S["a"],x=(s("f544"),Object(u["a"])($,j,k,!1,null,"52b4ee30",null)),I=x.exports,w={name:"GenericTicketDetail",components:{Steps:I,Comments:C,Details:f},props:{object:{type:Object,default:function(){return{}}},specialCardItems:{type:Array,default:function(){return[]}},detailCardItems:{type:Array,default:function(){return[]}},assignedCardItems:{type:Array,default:function(){return[]}}},data:function(){return{}}},O=w,A=Object(u["a"])(O,a,i,!1,null,"04e7d998",null);e["a"]=A.exports},c564:function(t,e,s){"use strict";(function(t){s("ac6a"),s("f3e2");var a=s("ed08"),i=s("cf45"),n=s("e67a"),o=s("0218");e["a"]={name:"Steps",components:{IBox:n["a"]},props:{object:{type:Object,default:function(){return{}}}},data:function(){return{STATUS:{open:2,close:3},process:this.object.process_map,thisCopy:this,statusMap:o["a"],isFinish:!1}},computed:{ticketSteps:function(){var e=0;return this.process.forEach((function(t){"approved"===t.state&&(e+=1)})),e===t.length?(this.isFinish=!0,t.length+2):this.STATUS.open+e}},methods:{formatTime:function(t){return Object(a["a"])(Object(a["b"])(t))},toSafeLocalDateStr:function(t){return Object(i["p"])(t)},lookOver:function(t){var e=this.$createElement,s=[];t.forEach((function(t){s.push(e("p",null,t))})),this.$msgbox({title:"相关受理人",message:e("p",null,s),showCancelButton:!1,showConfirmButton:!1})}}}}).call(this,s("4362"))},ed08:function(t,e,s){"use strict";s.d(e,"a",(function(){return n})),s.d(e,"b",(function(){return o}));s("28a5"),s("78ce"),s("f576"),s("a481"),s("6b54"),s("87b3");var a=s("7618");function i(t,e){if(0===arguments.length)return null;var s,i=e||"{y}-{m}-{d} {h}:{i}:{s}";"object"===Object(a["a"])(t)?s=t:("string"===typeof t&&/^[0-9]+$/.test(t)&&(t=parseInt(t)),"number"===typeof t&&10===t.toString().length&&(t*=1e3),s=new Date(t));var n={y:s.getFullYear(),m:s.getMonth()+1,d:s.getDate(),h:s.getHours(),i:s.getMinutes(),s:s.getSeconds(),a:s.getDay()},o=i.replace(/{([ymdhisa])+}/g,(function(t,e){var s=n[e];return"a"===e?["日","一","二","三","四","五","六"][s]:s.toString().padStart(2,"0")}));return o}function n(t,e){t=10===(""+t).length?1e3*parseInt(t):+t;var s=new Date(t),a=Date.now(),n=(a-s)/1e3;return n<30?"刚刚":n<3600?Math.ceil(n/60)+"分钟前":n<86400?Math.ceil(n/3600)+"小时前":n<172800?"1天前":e?i(t,e):s.getMonth()+1+"月"+s.getDate()+"日"+s.getHours()+"时"+s.getMinutes()+"分"}function o(t){return Date.parse(t.replace(/-/gi,"/"))}},edf2:function(t,e,s){},f544:function(t,e,s){"use strict";var a=s("edf2"),i=s.n(a);i.a},f576:function(t,e,s){"use strict";var a=s("5ca1"),i=s("2e08"),n=s("a25f"),o=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(n);a(a.P+a.F*o,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})}}]);